<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="css/cssbaitap8-9javasrcipt.css">
    <style>
        .btuAdd {
            margin-top: 20px; /* Đảm bảo margin-top được áp dụng */
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="backgorud"></div>
        <div class="item">
            <div class="head">
                <div class="row">
                    <div class="col-8 mb-1">
                        <h1>Thông tin Lớp Học</h1>                     
                    </div>      
                    <div class="col-4 mb-1">                
                        <div class="row">
                            <div class="col-3 ml-5">
                                <h3 id="numberStudents">150</h3>
                                <p>Students Maths</p>
                            </div>
                            <div class="col-3 ml-5">
                                <h3 id="numberSujects">05</h3>
                                <p>Subjects</p>
                            </div>
                            <div class="col-3 ml-5">
                                <h3 id="numberExams">84</h3>
                                <p>Scored</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="inputRepair">
                <div class="row">
                    <div class="col-1 colIcon">
                        <svg xmlns="http://www.w3.org/2000/svg" width="42" height="42" fill="currentColor" class="bi bi-person-add" viewBox="0 0 16 16">
                            <path d="M12.5 16a3.5 3.5 0 1 0 0-7 3.5 3.5 0 0 0 0 7m.5-5v1h1a.5.5 0 0 1 0 1h-1v1a.5.5 0 0 1-1 0v-1h-1a.5.5 0 0 1 0-1h1v-1a.5.5 0 0 1 1 0m-2-6a3 3 0 1 1-6 0 3 3 0 0 1 6 0M8 7a2 2 0 1 0 0-4 2 2 0 0 0 0 4"/>
                            <path d="M8.256 14a4.5 4.5 0 0 1-.229-1.004H3c.001-.246.154-.986.832-1.664C4.484 10.68 5.711 10 8 10q.39 0 .74.025c.226-.341.496-.65.804-.918Q8.844 9.002 8 9c-5 0-6 3-6 4s1 1 1 1z"/>
                        </svg>
                    </div>
                    <div class="col-3">
                        <p id ="textName">Student's Name</p>
                        <input type="text" id="Name" name="" id="" required>
                    </div>
                    <div class="col-2">
                        <p id="textSubject">Subject</p>
                        <select id="Subject" name="sort" onchange="">
                            <option value="Trống"></option> 
                            <option value="Toán">Toán</option>        
                            <option value="Lý">Lý</option>   
                            <option value="Hóa">Hóa</option>                                         
                        </select>
                    </div>  
                    <div class="col-2">
                        <p id="textMark">Marks Scored</p>
                        <input type="text"id="Scored" name="" id="" required>
                    </div>
                    <div class="col-2 Type">
                        <p id="textExams">Type of Exams</p>
                        <select name="" id="Type">
                            <option value="Trống"></option> 
                            <option value="15 phút">15 phút</option> 
                            <option value="60 phút">60 phút</option> 
                            <option value="90 phút">90 phút</option> 
                        </select>
                    </div>
                    <div class="col-2 mb-10">
                        <a href="#" onclick="addNow()" class="btuAdd" id="btuAd">Add now</a>
                    </div>
                </div>
            </div>
            <div class="input2">
                <div class="OKEdit">
                    <a href="#" onclick="OKEdit1()" >OK Edit</a>
                </div>
                <div class="search">
                    <input type="text" class="search" id="searchh" placeholder="Search Name" onkeyup ="fucSearch(this)">
                 </div>
                <div class="output">
                    <table class="table table-bordered table-striped">
                        <thead>
                            <tr>
                                <th>Student's Name</th>
                                <th>Subject</th>
                                <th>Marks Scored</th>
                                <th>Type of Exams</th>
                                <th>Function</th>
                            </tr>
                        </thead>
                        <tbody id="cart-list">
                            <tr>
                                <td>Hoàng Gia Khánh</td>
                                <td>Toán</td>
                                <td>10</td>
                                <td>15 Phút</td>
                                <td>
                                    <div class="row">
                                        <div class="col-6">
                                            <a href="" class="Edit" id="Editt">Edit</a>
                                        </div>
                                        <div class="col-6">
                                            <a href="" class="Delete" id="Deletee">Delete</a>
                                        </div>
                                    </div> 
                                </td>
                            </tr>                  
                        </tbody>
                    </table>
                </div>
            </div>         
        </div>    
    </div>
    <script type="text/javascript">
        var idd =0;
        var isEdit = false;
        function checkinput(){
            let ischeck = false;
            const  namee = document.getElementById("Name").value;
            const subject = document.getElementById("Subject").value;
            const scored = document.getElementById("Scored").value;
            const typee = document.getElementById("Type").value;
            let textName = document.getElementById("textName");
            let textSubject  = document.getElementById("textSubject");
            let textMark = document.getElementById("textMark");
            let textExams = document.getElementById("textExams")
         if(namee==""){  
            textName.style.color = "red";
            ischeck = true;
         }
         else{
            textName.style.color ="black";
         }
         if(scored==""){  
            textMark.style.color = "red";
            ischeck = true;
         }
         else{
            textMark.style.color ="black";
         }
         if(subject =="Trống"){
            textSubject.style.color ="red";
            ischeck = true;
         }
         else{
            textSubject.style.color="black";
         }
         if(typee=="Trống"){
            textExams.style.color ="red";
            ischeck = true;
         }
         else{
            textExams.style.color="black";
         }
         if(ischeck){
            alert("Chưa điền đầy đủ thông tin");
            return false;
         }
         return true;   
        }
        var numberid = 0;
     function addNow(){
        if(checkinput()){
            let  namee = document.getElementById("Name");
            let subject = document.getElementById("Subject");
            let scored = document.getElementById("Scored");
            let typee = document.getElementById("Type");      
            var cart = localStorage.getItem("cart");//[{id:...,title:....}] // chỉ nhẫn dữ liệu dương String
            if (cart === null) {
            cart = [];
            } else {
                try {
                    cart = JSON.parse(cart);
                } catch (e) {
                    console.error("Error parsing cart from localStorage:", e);
                    cart = []; // If parsing fails, initialize an empty array
                }
            }

            for(let i of cart){
                if(numberid==i.id){
                    numberid++;
                }    
            }
            var item ={
                id : numberid,
                StudentName : namee.value,
                Subject: subject.value,
                Scored : scored.value,
                Exmas : typee.value,
            }           
            cart.push(item);// thêm giá trị vào cart
            getTablbe(cart);
            namee.value = "";
            subject.value = "Trống";
            scored.value = "";
            typee.value = "Trống";
            Information();
        }     
     }
     function EditItem(id){
        var cart = localStorage.getItem("cart");//[{id:...,title:....}] // chỉ nhẫn dữ liệu dương String
            if(cart == null || cart == undefined || cart == NaN){
                cart =[];
            }else{
                cart =JSON.parse(cart);    //ép string thành chuổi array           
            }
            for(var i of cart){              
                if(id==i.id){                 
                    var item ={
                        id : i.id,
                        StudentName : i.StudentName,
                        Subject: i.Subject,
                        Scored : i.Scored,
                        Exmas : i.Exmas,
                    }
                }               
            }
            let  namee = document.getElementById("Name");
            let subject = document.getElementById("Subject");
            let scored = document.getElementById("Scored");
            let typee = document.getElementById("Type"); 
            namee.value = item.StudentName;
            subject.value = item.Subject;
            scored.value = item.Scored;
            typee.value = item.Exmas;
            isEdit = true;
            idd = id;
           
     }
     function OKEdit1(){
        if(checkinput() && isEdit)
       { var cart = localStorage.getItem("cart");//[{id:...,title:....}] // chỉ nhẫn dữ liệu dương String
            if(cart == null || cart == undefined || cart == NaN){
                cart =[];
            }else{
                cart =JSON.parse(cart);    //ép string thành chuổi array           
            }
            let  namee = document.getElementById("Name");
            let subject = document.getElementById("Subject");
            let scored = document.getElementById("Scored");
            let typee = document.getElementById("Type"); 
            const item1 = cart.find(item => item.id == idd);
            if (item1) {
                item1.StudentName = namee.value;
                item1.Subject = subject.value;
                item1.Scored = scored.value;
                item1.Exmas = typee.value;
            }
            getTablbe(cart);
            isEdit = false; 
            Information();
        }   
     }
     function DeleteItem(id){
        var cart = localStorage.getItem("cart");//[{id:...,title:....}] // chỉ nhẫn dữ liệu dương String
            if(cart ==null && cart == undefined){
                cart =[];
            }else{
                cart =JSON.parse(cart);    //ép string thành chuổi array           
            }
            const index = cart.findIndex(user => user.id == id);
            if (index !== -1) {
                // Xóa phần tử tại chỉ mục `index`
                cart.splice(index, 1);
            }
            getTablbe(cart);
            Information();
          
     }
     function getTablbe(cart) {
        cart =JSON.stringify(cart); // ép kiểu qua dang string để thêm nó vào local
        localStorage.setItem("cart",cart);//Thêm cào local
        var cart = localStorage.getItem("cart");// đọc dữ liệu từ local
        cart = JSON.parse(cart); // ép kiểu về array
        var list = document.getElementById("cart-list");
        list.innerHTML = ``;
        console.log(cart);
        if(cart != null){
                var grand_total = 0;
                for(var item of cart){                
                    var item_html = `<tr>                        
                                <td>${item.StudentName}</td>
                                <td>${item.Subject}</td>
                                <td>${item.Scored}</td>
                                <td>${item.Exmas}</td>
                                <td>
                                <div class="row">
                                    <div class="col-6">
                                        <a href="#" class="Edit" id="Editt" onclick="EditItem(${item.id})">Edit</a>
                                    </div>
                                    <div class="col-6">
                                        <a href="#" class="Delete" id="Deletee" onclick="DeleteItem(${item.id})">Delete</a>
                                    </div>
                                </div> 
                            </td>
                            </tr>`   ; 
                    list.innerHTML += item_html;        
                }
            
        }   
     } 
    var isSearch = false;
    var cartadd =[];
   function  fucSearch(e){
        var inputSearch = e.value;
        var istrue = false;
        var cart = localStorage.getItem("cart");//[{id:...,title:....}] // chỉ nhẫn dữ liệu dương String
                if(cart == null || cart == undefined || cart == ""){
                    cart =[];
                }else{
                    try {
                        cart = JSON.parse(cart);
                        istrue = true;
                        
                    } 
                    catch (e) {                                        
                    }     
                }
              
        if(!isSearch) {
            isSearch = true;
            cartadd = cart;
            console.log("123");
            console.log(cartadd);
        }
        if(istrue){
        var search =[];
        for(var i of cartadd){
            if(i.StudentName == inputSearch){
                var item = {
                    id : i.id,
                    StudentName : i.StudentName,
                    Subject: i.Subject,
                    Scored : i.Scored,
                    Exmas : i.Exmas,
                };
                search.push(item);
            }
        }
        getTablbe(search);
        console.log("852");
     }
        if(e.value=="")
        {
            console.log("456");
            console.log(cartadd);
            getTablbe(cartadd);
            isSearch = false;
        }     
   }
   function Loaddat(){
        var cart = localStorage.getItem("cart");
        if(cart == null || cart==undefined || cart==NaN ){
            cart =[];
            }
        else{   
            try{   
                cart = JSON.parse(cart); 
                getTablbe(cart);
            }
            catch(e)
            {}
        }                       
   }
   function Information(){
    let lableName = document.getElementById("numberStudents");
    let lableSujects = document.getElementById("numberSujects");
    let lableExmas = document.getElementById("numberExams");
    var cart =  localStorage.getItem("cart");
    if(cart ==null|| cart ==undefined || cart ==NaN)
    {
        cart =[];
    }
    else{
        cart = JSON.parse(cart);

    }
    let numberStudens = 0;
    let numberSujects = 0;
    let numberScored = 0;
    for(let i of cart){
        numberStudens++;
        if(i.Subject=="Toán"){
            numberSujects++;
        }
        var intA = parseInt(i.Scored);
        if(intA!=NaN || intA!=null){
            if(intA > 5){
                numberScored++;
            }
        } 

    }
    lableName.innerText=numberStudens>=10?numberStudens:`0${numberStudens}`;
    lableSujects.innerText=numberSujects>=10?numberSujects:`0${numberSujects}`;
    lableExmas.innerText=numberScored>=10?numberScored:`0${numberScored}`;
    

   }
   Loaddat();
   Information();
    </script>
</body>
</html>